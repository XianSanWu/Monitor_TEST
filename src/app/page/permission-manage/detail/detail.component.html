<loading-indicator></loading-indicator>

<div class="pageTitle mb-4">
  <h2>
    <i class="bi bi-list-task"></i>
    æ¬Šé™è¨­å®š - å¸³è™Ÿè¨­å®š
  </h2>
</div>

<collapsible-section
  [id]="'PermissionDetail'"
  title="âš™ï¸ è¨­å®šæ¢ä»¶"
  tooltipText="è«‹è¼¸å…¥å°æ‡‰æ¢ä»¶è¨­å®šã€‚"
>
  <!-- è‡ªè¨‚è¡¨å–® -->
  <div [formGroup]="validateForm" class="mb-3">
    <div
      class="d-flex justify-content-between align-items-center flex-wrap gap-3"
    >
      <!-- å·¦å´æ¬„ä½ -->
      <div class="d-flex gap-3 flex-wrap">
        <!-- å¸³è™Ÿ(å“¡ç·¨) -->
        <basic-input
          title="å¸³è™Ÿ(å“¡ç·¨)"
          [form]="validateForm"
          ctlName="userName"
          placeholder="è«‹è¼¸å…¥å¸³è™Ÿ"
          [maxlength]="10"
        ></basic-input>

        <!-- å¯è¤‡è£½å•Ÿç”¨å¸³è™Ÿ -->
        <search-select
          *ngIf="showButtons"
          title="å¯è¤‡è£½å•Ÿç”¨å¸³è™Ÿ"
          [form]="validateForm"
          ctlName="copyUserName"
          placeholder="è«‹è¼¸å…¥æ”¶å°‹"
          [options]="copyUserNameList"
        >
        </search-select>
      </div>

      <!-- å³å´æŒ‰éˆ•ç¾¤çµ„ -->
      <div *ngIf="showButtons" class="d-flex align-items-center gap-2">
        <!-- æ¸…ç©ºå‹¾é¸ -->
        <button
          class="btn d-flex align-items-center justify-content-center gap-2 px-4 py-2 rounded-pill shadow-sm"
          style="background-color: #dc3545; color: white; min-width: 140px"
          (click)="clearAll()"
        >
          <i class="bi bi-x-lg fs-5"></i>
          <span class="fw-bold">æ¸…ç©ºå‹¾é¸</span>
        </button>

        <!-- å…¨é¸ -->
        <button
          class="btn d-flex align-items-center justify-content-center gap-2 px-4 py-2 rounded-pill shadow-sm"
          style="background-color: #0d6efd; color: white; min-width: 140px"
          (click)="selectAll()"
        >
          <i class="bi bi-check2-all fs-5"></i>
          <span class="fw-bold">å…¨é¸</span>
        </button>

        <!-- å„²å­˜ -->
        <button
          class="btn d-flex align-items-center justify-content-center gap-2 px-4 py-2 rounded-pill shadow-sm"
          [disabled]="validateForm.invalid"
          style="background-color: #198754; color: white; min-width: 140px"
          (click)="onSave()"
        >
          <i class="bi bi-check-lg fs-5"></i>
          <span class="fw-bold">å„²å­˜</span>
        </button>
      </div>
    </div>
  </div>
</collapsible-section>

<collapsible-section
  [id]="'PermissionDetailBody'"
  title="ğŸ’¾ å‹¾é¸è¨­å®šæ¢ä»¶"
  tooltipText="è«‹å‹¾é¸è¨­å®šæ¢ä»¶ã€‚"
>
  <div class="permission-form" *ngFor="let group of groupedPermissions">
    <div class="module-title">
      <span [matTooltip]="group.header.ModuleName + ' - ' + group.header.Title"  matTooltipPosition="above">
        <i *ngIf="group.header.Icon" [class]="group.header.Icon"></i>
        {{ group.header.ModuleName }} - {{ group.header.Title }}
      </span>
    </div>

    <div class="table-wrapper">
      <table class="permission-table">
        <thead>
          <tr>
            <th class="text-col">åŠŸèƒ½</th>
            <th class="text-col">åŠŸèƒ½æè¿°</th>
            <th class="icon-header">åœ–ç¤º</th>
            <th class="text-col">é€£çµ</th>
            <th *ngFor="let action of allActions" class="fixed-col">
              {{ action }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of group.items">
            <td class="text-col ellipsis" [matTooltip]="item.FeatureName">
              {{ item.FeatureName }}
            </td>
            <td class="text-col ellipsis" [matTooltip]="item.Title">
              {{ item.Title }}
            </td>
            <td class="icon-cell" [matTooltip]="item.Icon">
              <i *ngIf="item.Icon" [class]="item.Icon"></i>
            </td>
            <td class="text-col ellipsis" [matTooltip]="item.Link">
              {{ item.Link }}
            </td>

            <td
              *ngFor="let action of allActions"
              class="checkbox-cell fixed-col"
            >
              <span
                [matTooltip]="
                  isActionEnabled(item, action) ? 'å¯é»é¸' : 'ç¦ç”¨é»é¸'
                "
              >
                <!-- matTooltipPosition="above" -->
                <mat-checkbox
                  [disabled]="!isActionEnabled(item, action)"
                  [(ngModel)]="item.ActionMap[action]"
                >
                </mat-checkbox>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</collapsible-section>

<div
  *ngIf="showButtons"
  class="submit-section text-end d-flex gap-2 justify-content-end"
>
  <!-- æ¸…ç©ºå‹¾é¸ -->
  <button
    class="btn d-flex align-items-center justify-content-center gap-2 px-4 py-2 rounded-pill shadow-sm"
    style="background-color: #dc3545; color: white; min-width: 140px"
    (click)="clearAll()"
  >
    <i class="bi bi-x-lg fs-5"></i>
    <span class="fw-bold">æ¸…ç©ºå‹¾é¸</span>
  </button>

  <!-- å…¨é¸ -->
  <button
    class="btn d-flex align-items-center justify-content-center gap-2 px-4 py-2 rounded-pill shadow-sm"
    style="background-color: #0d6efd; color: white; min-width: 140px"
    (click)="selectAll()"
  >
    <i class="bi bi-check2-all fs-5"></i>
    <span class="fw-bold">å…¨é¸</span>
  </button>

  <!-- å„²å­˜ -->
  <button
    class="btn d-flex align-items-center justify-content-center gap-2 px-4 py-2 rounded-pill shadow-sm"
    [disabled]="validateForm.invalid"
    style="background-color: #198754; color: white; min-width: 140px"
    (click)="onSave()"
  >
    <i class="bi bi-check-lg fs-5"></i>
    <span class="fw-bold">å„²å­˜</span>
  </button>
</div>
