<loading-indicator></loading-indicator>

<div class="pageTitle">
  <h2>
    <i class="bi bi-list-task"></i>
    EDM å·¥ä½œé€²åº¦æŸ¥è©¢
  </h2>
</div>

<!-- ç‹€æ…‹æµç¨‹é¡¯ç¤º -->
<collapsible-section [isOpen]="false" title="ğŸ§­ ç‹€æ…‹æµç¨‹é¡¯ç¤º">
  <div style="display: flex; justify-content: flex-start">
    <atto-progress [items]="edmAttoProgress"> </atto-progress>
  </div>
</collapsible-section>

<!-- è‡ªè¨‚è¡¨å–® -->
<div [formGroup]="validateForm">
  <div class="row">
    <basic-input
      title="ä¾†æº"
      class="col-2"
      [form]="validateForm"
      [disabled]="true"
      [isHidden]="true"
      ctlName="channel"
      placeholder="è«‹è¼¸å…¥"
      [maxlength]="30"
    ></basic-input>
  </div>
</div>

<!-- å¡å¤«å¡å·¥ä½œé‡ -->
<collapsible-section title="ğŸ“Š Kafka Partition Lag (å¡å¤«å¡å·¥ä½œé‡)">
  <div *ngIf="(respData1?.PartitionLags?.length ?? 0) > 0">
    <div class="row g-3 mt-2">
      <div
        class="col-md-6 col-lg-4"
        *ngFor="let item of respData1?.PartitionLags"
      >
        <div class="card shadow-sm">
          <div class="card-header bg-dark text-white">
            ğŸ§© Partition {{ item?.Partition }}
          </div>
          <div class="card-body">
            <p class="mb-1">
              <strong>Committed Offset:</strong> {{ item?.CommittedOffset }}
            </p>
            <p class="mb-1">
              <strong>High Watermark:</strong> {{ item?.HighWatermark }}
            </p>
            <p class="mb-0">
              <strong>Lag:</strong>
              <span
                [ngClass]="{
                  'text-success fw-bold': (item?.Lag ?? 0) <= 10,
                  'text-warning fw-bold':
                    (item?.Lag ?? 0) > 10 && item.Lag <= 100,
                  'text-danger fw-bold': (item?.Lag ?? 0) > 100
                }"
              >
                {{ item.Lag }}
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸ‘‡ åŠ ç¸½å€å¡Š -->
    <ng-container *ngIf="respData1?.PartitionLags as lags">
      <div class="alert alert-info mt-4 text-end">
        <strong>ğŸ“ˆ Kafka Lag æ¦‚è¦½ï¼š</strong><br />
        <div>
          âœ… <strong>å·²è™•ç†ï¼š</strong>
          {{
          committedTotal
          }}
        </div>
        <div>
          â³ <strong>å¾…è™•ç†ï¼š</strong>
          <span
            [ngClass]="{
              'text-success fw-bold': (respData1?.TotalLag ?? 0) <= 10,
              'text-warning fw-bold':
                (respData1?.TotalLag ?? 0) > 10 &&
                (respData1?.TotalLag ?? 0) <= 100,
              'text-danger fw-bold': (respData1?.TotalLag ?? 0) > 100
            }"
          >
            {{ respData1?.TotalLag }}
          </span>
        </div>
        <div>
          ğŸ“Š <strong>ç¸½æ•¸ï¼š</strong>
          {{
          highWatermarkTotal
          }}
        </div>
      </div>
    </ng-container>
  </div>
</collapsible-section>

<!-- ag-gridè¡¨å–® -->
<collapsible-section
  title="ğŸ“‹ EDM æŸ¥è©¢åˆ—è¡¨"
  tooltipText="é»æ“Šæ¬„ä½å…©ä¸‹ï¼Œå¯ä»¥è¤‡è£½è©²æ¬„ä½è³‡æ–™ï¼Œå–®æ“Šå¯è·³è½‰è¶…é€£çµï¼ˆè‹¥ç‚ºç¶²å€ï¼‰"
>
  <div class="row">
    <ag-grid-angular
      #agGrid
      style="width: 100%; height: 500px"
      class="ag-theme-alpine"
      [rowData]="rowData"
      [columnDefs]="columnDefs"
      [defaultColDef]="defaultColDef"
      [pagination]="false"
      [animateRows]="true"
      (gridReady)="onGridReady($event)"
      (sortChanged)="onSortChanged()"
      (filterChanged)="onFilterChanged()"
      (cellDoubleClicked)="onCellDoubleClicked($event)"
    >
    </ag-grid-angular>

    <div
      style="margin-top: 10px"
      class="d-flex justify-content-center align-items-center gap-2"
    >
      <button
        class="btn btn-primary"
        (click)="onPageChange(1)"
        [disabled]="currentPage === 1"
      >
        First Page
      </button>
      <button
        class="btn btn-secondary"
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 1"
      >
        Previous
      </button>
      <span class="mx-2">Page {{ currentPage }} / {{ totalPages }}</span>
      <button
        class="btn btn-secondary"
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage === totalPages"
      >
        Next
      </button>
      <button
        class="btn btn-primary"
        (click)="onPageChange(totalPages)"
        [disabled]="currentPage === totalPages"
      >
        Last Page
      </button>
    </div>
  </div>
</collapsible-section>
