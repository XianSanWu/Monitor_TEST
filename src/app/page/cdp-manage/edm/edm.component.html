<loading-indicator></loading-indicator>

<div class="pageTitle">
  <h2>【EDM 工作進度查詢】</h2>
</div>

<!-- 狀態流程顯示 -->
<collapsible-section title="🧭 狀態流程顯示">
<div style="display: flex; justify-content: flex-start">
  <atto-progress [items]="edmAttoProgress"> </atto-progress>
</div>
</collapsible-section>

<!-- 自訂表單 -->
<div [formGroup]="validateForm">
  <div class="row">
    <basic-input
      title="工作進度查詢"
      class="col-2"
      [form]="validateForm"
      [disabled]="true"
      [isHidden]="true"
      ctlName="channel"
      placeholder="請輸入"
      [maxlength]="30"
    ></basic-input>
  </div>
</div>

<!-- 卡夫卡工作量 -->
<collapsible-section title="📊 Kafka Partition Lag (卡夫卡工作量)">
  <div *ngIf="(respData1?.PartitionLags?.length ?? 0) > 0">
    <!-- <h5 class="mt-3">📊 Kafka Partition Lag (卡夫卡工作量)</h5> -->
    <div class="row g-3 mt-2">
      <div
        class="col-md-6 col-lg-4"
        *ngFor="let item of respData1?.PartitionLags"
      >
        <div class="card shadow-sm">
          <div class="card-header bg-dark text-white">
            🧩 Partition {{ item?.Partition }}
          </div>
          <div class="card-body">
            <p class="mb-1">
              <strong>Committed Offset:</strong> {{ item?.CommittedOffset }}
            </p>
            <p class="mb-1">
              <strong>High Watermark:</strong> {{ item?.HighWatermark }}
            </p>
            <p class="mb-0">
              <strong>Lag:</strong>
              <span
                [ngClass]="{
                  'text-success fw-bold': (item?.Lag ?? 0) <= 10,
                  'text-warning fw-bold':
                    (item?.Lag ?? 0) > 10 && item.Lag <= 100,
                  'text-danger fw-bold': (item?.Lag ?? 0) > 100
                }"
              >
                {{ item.Lag }}
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="alert alert-info mt-4 text-end">
      <strong>Total Lag: </strong>
      <span
        [ngClass]="{
          'text-success fw-bold': (respData1?.TotalLag ?? 0) <= 10,
          'text-warning fw-bold':
            (respData1?.TotalLag ?? 0) > 10 &&
            (respData1?.TotalLag ?? 0) <= 100,
          'text-danger fw-bold': (respData1?.TotalLag ?? 0) > 100
        }"
      >
        {{ respData1?.TotalLag }}
      </span>
    </div>
  </div>
</collapsible-section>

<!-- ag-grid表單 -->
<collapsible-section title="📋 EDM 查詢列表">
<div class="row">
  <ag-grid-angular
    #agGrid
    style="width: 100%; height: 500px"
    class="ag-theme-alpine"
    [rowData]="rowData"
    [columnDefs]="columnDefs"
    [defaultColDef]="defaultColDef"
    [pagination]="false"
    [animateRows]="true"
    (gridReady)="onGridReady($event)"
    (sortChanged)="onSortChanged()"
    (filterChanged)="onFilterChanged()"
  >
  </ag-grid-angular>

  <div
    style="margin-top: 10px"
    class="d-flex justify-content-center align-items-center gap-2"
  >
    <button
      class="btn btn-primary"
      (click)="onPageChange(1)"
      [disabled]="currentPage === 1"
    >
      First Page
    </button>
    <button
      class="btn btn-secondary"
      (click)="onPageChange(currentPage - 1)"
      [disabled]="currentPage === 1"
    >
      Previous
    </button>
    <span class="mx-2">Page {{ currentPage }} / {{ totalPages }}</span>
    <button
      class="btn btn-secondary"
      (click)="onPageChange(currentPage + 1)"
      [disabled]="currentPage === totalPages"
    >
      Next
    </button>
    <button
      class="btn btn-primary"
      (click)="onPageChange(totalPages)"
      [disabled]="currentPage === totalPages"
    >
      Last Page
    </button>
  </div>
</div>
</collapsible-section>
